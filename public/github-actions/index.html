<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2020-05-23">

<title>skeptric - Using Github Actions with Hugo</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">skeptric</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html">About</a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/EdwardJRoss"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Using Github Actions with Hugo</h1>
  <div class="quarto-categories">
    <div class="quarto-category">programming</div>
    <div class="quarto-category">blog</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 23, 2020</p>
    </div>
  </div>
    
  </div>
  

</header>

<p>I really like the idea of having a process triggered automatically when I push code. Github actions gives a way to do this with Github repositories, and this article was first published with a Github action. While convenient for simple things Github actions seem hard to customise, heavyweight to configure and give me security concerns.</p>
<p>My workflow for publishing this website used to be commit and push the changes and run a deploy script. When I used a different laptop with a more recent version of Hugo this resulted in some issues, and it wasn’t easy for me to use the earlier version from my package manager. While I could use something like Docker this was a good excuse to automatically get a properly configured server to publish automatically.</p>
<p>You could long do this <a href="https://www.digitalocean.com/community/tutorials/how-to-use-git-hooks-to-automate-development-and-deployment-tasks">with a git post-receive hook</a> on a self-hosted server or <a href="https://about.gitlab.com/stages-devops-lifecycle/continuous-integration/">Gitlab CI</a> or other CI tools. Recently Github released <a href="https://github.com/features/actions">Actions</a> which can do this (and also trigger on other Github events).</p>
<p>The <a href="https://help.github.com/en/actions">documentation for Github Actions</a> is pretty dense, describing each part in detail with no high-level howtos. After reading it for a couple of hours I understood enough to string together some marketplace actions into a workflow.</p>
<p>In my Github repository, in the “Actions” section, it has some prompts to get started. It suggested a Jekyll workflow (which is odd for a Hugo blog), so I searched the Marketplace for Hugo. It’s really hard to decide from the search results what I should to use, and strangely it’s not quite ranked by number of stars.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/github_marketplace_hugo.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Hugo Marketplace Search has Many Results</figcaption><p></p>
</figure>
</div>
<p>I read a the detail pages of a few, and <a href="https://github.com/marketplace/actions/hugo-setup">Hugo Setup</a> which had the most stars seemed to do what I needed. It has good documentation including a sample on how to publish to Github pages. A great feature is that I can specify the Hugo version, so my website won’t be broken immediately by changes to Hugo.</p>
<p>However I don’t use Github Pages and I’ve been syncing the output with <a href="https://rclone.org/">rclone</a>. I couldn’t figure out how to do this directly, so I went back to the marketplace to find <a href="https://github.com/marketplace/actions/github-action-for-rclone">github action for rclone</a>. I could store my rclone configuration as a Github secret called RCLONE_CONF (under Settings &gt; Secrets) and then inject it into the Github workflow file using <code>${{ secrets.RCLONE_CONF }}</code>.</p>
<p>This is where I stopped to think; can the action author steal my secrets? So I read the <a href="https://github.com/wei/rclone">source code</a>, which was thankfully straightforward, and saw that if I assume https://rclone.org is secure and that the code the action executes is the same as the source then it should be secure. I don’t know if there’s any way to guarantee that I continue to use this version, or if there’s any vetting of marketplace code.</p>
<p>Together this gave me a <a href="https://github.com/EdwardJRoss/skeptric/commit/768a3c4a99a609bcc405250ca0c810997ded3069#diff-28efe7aa483f09b068ac33bc4a36e361">Github workflow</a> to build and publish this website (except rebuilding <a href="../blogdown">blogdown posts</a>). Overall the experience seems with Github actions seems to push the Marketplace, which is not really easy to understand and it feels clunky to compose actions when compared to composing scripts on Linux. For something this simple where actions existed it was straightforward, but for something more complex I would have to <a href="https://help.github.com/en/actions/creating-actions/about-actions">write my own action</a>. The <a href="https://github.com/wei/rclone">rclone action</a> shows this could be straightforward with Docker, but the <a href="https://github.com/peaceiris/actions-hugo">hugo action</a> shows it can get quite involved.</p>
<p>From a strategic position I can understand why Github is pushing the marketplace so hard. Gitlab has had a much better CI story for a long time (and as far as I can tell still does today), but Github has a far larger community. By leveraging the community to build useful actions and encouraging developers to use them for free will help get developers started with it. By encouraging chaining together lots of actions into workflows (which seems to be the fundamental design) will make it really difficult to migrate to another CI tool once you have complex workflows. Then they can monetise on projects that exceed the free quotas.</p>
<p>For me the next step would be to try to write a <a href="https://help.github.com/en/actions/creating-actions/dockerfile-support-for-github-actions">Docker action</a> which I should then be able to use on any linux server. The specific benefits of the Github action ecosystem currently seem low, and it is less mature than other CI tools. But it’s a useful free tool to have access to if you’re using Github for hosting code.</p>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>