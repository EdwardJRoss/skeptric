<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2022-01-31">

<title>skeptric - Test Driven Development in Machine Learning</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">skeptric</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html">About</a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/EdwardJRoss"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Test Driven Development in Machine Learning</h1>
  <div class="quarto-categories">
    <div class="quarto-category">testing</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 31, 2022</p>
    </div>
  </div>
    
  </div>
  

</header>

<p>Last weekend I read the first part of Kent Beck’s <a href="https://www.oreilly.com/library/view/test-driven-development/0321146530/">Test Driven Development: By Example</a>. He works through a simple example of programming with Test Driven Development in excruciating detail. It shows how you can move in small steps when things get tricky, which is often better than a long debugging session.</p>
<p>I typically develop code iteratively in a Jupyter Notebook or IPython REPL. I can pass the code I’m writing and interactively inspect it to make sure it works as inspected. This is an efficient way to work, especially with unknown and messy data. But you build up state in the REPL, and a model in your mind, which may diverge from the actual code. And when the session is finished you won’t know if you’ve introduced a regression, unless you also run tests.</p>
<p>I tried out Test Driven Development on a real problem, and found it very useful. I found it often helped me notice coding issues much earlier, and resolve them much faster. There were times when things got tricky and moving in small steps was very helpful. At one point I introduced a regression and was able to notice and resolve it very quickly. It didn’t stop all issues at runtime, because existing code was untested, but I spent less time debugging.</p>
<p>The rest of this article goes through a detailed account of how I used TDD to implement this feature.</p>
<section id="the-process" class="level1">
<h1>The process</h1>
<p>Kent Beck describes the TDD cycle as:</p>
<ul>
<li>Add a little test</li>
<li>Run all the tests and fail</li>
<li>Make a change</li>
<li>Run the tests and succeed</li>
<li>Refactor to remove duplication</li>
</ul>
<p>I needed to have a little test that would check that the model had correctly loaded the weights. A simple test would be to initialise the model with input weights, evaluate the embedding on an input, and then check that it matches the input weight. However it wasn’t immediately obvious to me how to even run the model.</p>
<p>So I started with a test that just ran the model on some data and checked the output dimensions. I used some existing code to write and call the model, and after getting it wrong a few times the test passed. Then I broke the test, changing the dimension check so it was wrong, to make sure the test was actually working. When the test failed I undid my change and had an example of loading and calling a model in the test code.</p>
<p>Now I was in a position to write a test, and I had to work out where it would fit.</p>
<section id="add-a-little-test" class="level2">
<h2 class="anchored" data-anchor-id="add-a-little-test">Add a little test</h2>
<p>The overall model contained different Embedding layers. For some of the layers I needed to pass some pretrained weights. There was a common function to construct the embeddings, which seemed like the right place to set the weights.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tf.keras <span class="im">import</span> Sequential</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_categorical_embedding(dim: <span class="bu">int</span>, vocab: <span class="bu">list</span>[<span class="bu">str</span>]) <span class="op">-&gt;</span> Sequential:</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Sequential([</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>            tf.keras.layers.StringLookup(vocabulary<span class="op">=</span>vocab, mask_token<span class="op">=</span><span class="va">None</span>),</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Add + 1 for out of vocabulary</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>            tf.keras.layers.Embedding(<span class="bu">len</span>(vocab) <span class="op">+</span> <span class="dv">1</span>, dim),</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>            ])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Having identified the function, I tried to think of a simple test. The weights were stored in a file, which could easily be converted to a Pandas DataFrame with the categories on the index. There are lots of other ways the data could be represented, but I thought I’d start a test with this and see how it looked.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pytest</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="at">@pytest.fixture</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> weights():</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame([[<span class="fl">0.5</span>, <span class="fl">0.5</span>], </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>                         [<span class="fl">1.0</span>, <span class="fl">0.0</span>]],</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>                         index<span class="op">=</span>[<span class="st">"cat"</span>, <span class="st">"dog"</span>]</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_weighted_categorical_embedding_weights(weights):</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    tokens <span class="op">=</span> tf.convert_to_tensor([<span class="st">"cat"</span>, <span class="st">"dog"</span>])</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> get_categorical_embedding(</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>        dim<span class="op">=</span><span class="dv">4</span>, vocab<span class="op">=</span>weights.index, weights<span class="op">=</span>weights</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    embedding <span class="op">=</span> model(tokens).numpy()</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    expected <span class="op">=</span> np.array(</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>        [[<span class="fl">0.5</span>, <span class="fl">0.5</span>], [<span class="fl">1.0</span>, <span class="fl">0.0</span>]]</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> np.allclose(embedding, expected)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>However I realised I wasn’t clear on what should happen to an out of vocabulary token. The existing weights didn’t have one, and I had to think of something to do. I decided I should average the weights, and added it to the test. This was a bit too much to handle all at once, but I forged on ahead.</p>
</section>
<section id="run-a-test-and-fail" class="level2">
<h2 class="anchored" data-anchor-id="run-a-test-and-fail">Run a test and fail</h2>
<p>I ran the test and it failed. First it failed because I made some mistakes in the test code. When I fixed them it failed because <code>get_categorical_embedding</code> didn’t have a weights argument.</p>
</section>
<section id="make-a-change" class="level2">
<h2 class="anchored" data-anchor-id="make-a-change">Make a Change</h2>
<p>I added <code>weights</code> as an argument to the end of <code>get_categorical_embedding</code> and initialised it to <code>None</code>. It wasn’t immediately obvious what I needed to do next so I ran the tests again.</p>
</section>
<section id="run-a-test-and-fail-1" class="level2">
<h2 class="anchored" data-anchor-id="run-a-test-and-fail-1">Run a test and fail</h2>
<p>The assertion now failed because the random initial weights didn’t match the weights it was supposed to load. This wasn’t a surprise, since the code isn’t loading the weights yet. But now it’s getting to the point where that’s all I need to do.</p>
<p>It wasn’t clear how to load the weights though. I’d need to deal with the Out of Vocabulary tokens. The right TDD thing to do here would be to add it to my TODO list, and put anything in that made the tests pass. But instead I started thinking about how to get the weight matrix into the right shape.</p>
</section>
<section id="write-a-small-test" class="level2">
<h2 class="anchored" data-anchor-id="write-a-small-test">Write a Small Test</h2>
<p>I wanted a function that took in my weights DataFrame and did something reasonable for the out of vocabulary tokens. A reasonable thing to do would be to take the mean of all the other embeddings. So I added a test to do that.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_create_weight_matrix(weights):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    vocab <span class="op">=</span> [<span class="st">"dog"</span>, <span class="st">"cat"</span>]</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> create_weight_matrix(weights, vocab)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    mean_embedding <span class="op">=</span> [<span class="fl">0.75</span>, <span class="fl">0.25</span>]</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    expected <span class="op">=</span> np.array([mean_embedding, [<span class="fl">0.5</span>, <span class="fl">0.5</span>], [<span class="fl">1.0</span>, <span class="fl">0.0</span>]])</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> np.allclose(result, expected)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="run-a-test-and-fail-2" class="level2">
<h2 class="anchored" data-anchor-id="run-a-test-and-fail-2">Run a test and fail</h2>
<p>This test now failed because the function didn’t exist. So I went ahead and wrote a simple implementation.</p>
</section>
<section id="run-a-test-and-succeed" class="level2">
<h2 class="anchored" data-anchor-id="run-a-test-and-succeed">Run a test and succeed</h2>
<p>Then the test failed again; this time because of something like <code>0.7504 != 0.75</code>. It seemed that Tensorflow slightly changed the representation.</p>
<p>I added the argument <code>rtol=1e-3</code> to <code>np.allclose</code> to check less precisely. Then this test succeeded. I updated other tests to use the same tolerance.</p>
</section>
<section id="run-a-test-and-fail-3" class="level2">
<h2 class="anchored" data-anchor-id="run-a-test-and-fail-3">Run a test and fail</h2>
<p>Now I had the weights matrix with the out of vocabulary tokens I could add it to the embedding.</p>
<p>Looking at some examples it seemed like I should be able to add <code>weights=</code> to the <a href="https://www.tensorflow.org/api_docs/python/tf/keras/layers/Embedding"><code>Embedding</code></a> layer. It wasn’t explicitly documented, but it passes some keyword argument so I thought I would try it. However the test still failed, the initialisation was still random.</p>
</section>
<section id="run-a-test-and-fail-4" class="level2">
<h2 class="anchored" data-anchor-id="run-a-test-and-fail-4">Run a test and fail</h2>
<p>It looked like there were two ways I could do it; manually call <a href="https://www.tensorflow.org/api_docs/python/tf/keras/layers/Layer#set_weights"><code>set_weights</code></a>, which first requires instantiating the layer, or passing a <a href="https://www.tensorflow.org/api_docs/python/tf/keras/initializers/Constant"><code>Constant</code></a> Initializer, which claims it can only take scalar values. After seeing an example with Constant online I tried it and this test passed, but my first test calling the model failed.</p>
</section>
<section id="run-a-test-and-succeed-1" class="level2">
<h2 class="anchored" data-anchor-id="run-a-test-and-succeed-1">Run a test and succeed</h2>
<p>My code didn’t handle the case where the weights were <code>None</code>; I had introduced a regression. It was simple to write an <code>if</code> statement and this test passed.</p>
</section>
<section id="refactor" class="level2">
<h2 class="anchored" data-anchor-id="refactor">Refactor</h2>
<p>Now all my tests were passing I could take some time to refactor. I cleaned up some test code, but the model code looked good so I continued.</p>
</section>
<section id="write-a-small-test-1" class="level2">
<h2 class="anchored" data-anchor-id="write-a-small-test-1">Write a small test</h2>
<p>The full model now needed to get the embeddings with the weights. I wrote a simple test calling the model with an expected output.</p>
</section>
<section id="run-a-test-and-fail-5" class="level2">
<h2 class="anchored" data-anchor-id="run-a-test-and-fail-5">Run a test and fail</h2>
<p>The test immediately failed because the model didn’t have arguments for weights. I added them and propagated them to the call to <code>get_categorical_embedding</code>.</p>
<p>There were a cascade of small errors with how I wrote this, which I quickly fixed.</p>
</section>
<section id="run-a-test-and-succeed-2" class="level2">
<h2 class="anchored" data-anchor-id="run-a-test-and-succeed-2">Run a test and succeed</h2>
<p>Then I got a strange failure about dimensions not matching. It wasn’t obvious to me what was happening here. The dimensions it mentioned were 2 (which was the dimension of the weights) and 4. It then dawned on me that the embedding layer in my test had dimension 4, and the weights had dimension 2. I fixed the test and added a note to check the dimensions matched so this failure occurred at instantiation.</p>
<p>The tests were all passing now, and it seemed like it was working.</p>
</section>
<section id="checking-the-dimensions" class="level2">
<h2 class="anchored" data-anchor-id="checking-the-dimensions">Checking the dimensions</h2>
<p>I wrote a test to check if the embedding and weight dimensions don’t match it should raise a <code>ValueError</code>. The test failed as expected.</p>
<p>I then wrote the assertion and the test passed.</p>
<p>To make sure the error message was right, since sometimes I make mistakes with this, I changed the test to check for a <code>RuntimeError</code>. The test failed with the right message, and so I reverted my change.</p>
<p>However I’m not really checking my error message, and it is open to regression; a good extension would be to check the message itself.</p>
</section>
<section id="running-the-whole-thing" class="level2">
<h2 class="anchored" data-anchor-id="running-the-whole-thing">Running the whole thing</h2>
<p>I was now confident enough to run the whole process, which takes about ten minutes. It <em>still</em> failed a couple of times.</p>
<p>First I made a simple typo in a variable name. I ran <code>pyflakes</code> and noticed it would pick it up. I configured <code>pyflakes</code> to ignore all the other existing issues and added it to my <code>make test</code> command.</p>
<p>Next it failed to save the model at the end. I had passed a Pandas series as the vocabulary, and Tensorflow didn’t know how to serialise it. Converting to a list or numpy array fixed the problem.</p>
<p>After that it worked perfectly. All the testing gave me more confidence it was doing what I expected, rather than just running with the wrong weights. I’m pretty happy with my experience of TDD and want to keep trying it.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>